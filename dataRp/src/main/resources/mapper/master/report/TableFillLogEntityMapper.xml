<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.h3c.bigdata.zhgx.function.report.dao.TableFillLogEntityMapper">
  <resultMap id="BaseResultMap" type="com.h3c.bigdata.zhgx.function.report.entity.TableFillLogEntity">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="number" jdbcType="VARCHAR" property="number" />
    <result column="fill_sum" jdbcType="VARCHAR" property="fillSum" />
    <result column="fill_count" jdbcType="INTEGER" property="fillCount" />
    <result column="update_time" jdbcType="INTEGER" property="updateTime" />
    <result column="update_user" jdbcType="TIMESTAMP" property="updateUser" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, number, fill_sum, fill_count, update_time, update_user
  </sql>
  <!--更新数据填报记录的填报数量-->
    <update id="updateFillLogSum">
       UPDATE table_fill_log a
        SET a.fill_sum = a.fill_sum -1
        WHERE
            template_id = #{templateId} and  a.update_time = #{updateTime}
    </update>
  <!--更新数据填报记录的填报数量-->
  <update id="updateFillLogCount">
       UPDATE table_fill_log a
        SET a.fill_count = a.fill_count -1
        WHERE
            template_id = #{templateId} and  a.update_time = #{updateTime}
    </update>
    <!--更新数据填报记录表的模板id-->
    <update id="updateFillLogTemplateId">
       UPDATE table_fill_log a
       SET a.template_id = #{templateId}
        WHERE number = #{tableName}
    </update>

    <!--根据模板删除对应的填报记录-->
    <delete id="deleteByTemplateId">
        DELETE FROM table_fill_log WHERE template_id = #{templateId}
    </delete>
    <!--根据表名查询填报记录列表-->
  <select id="getTableFillLogsByTableName" resultMap="BaseResultMap">
    select  <include refid="Base_Column_List" />
    from table_fill_log where template_id = #{templateId}
    order by fill_count desc
  </select>
  <!--查询晚于updateTime的填报记录-->
  <select id="getLastFillLogsByUpdateTime"  resultMap="BaseResultMap">
    select  <include refid="Base_Column_List" />
    from table_fill_log where template_id =#{templateId}
    and update_time >= #{updateTime}
  </select>
</mapper>